import{r as h,e as o,j as l,l as e,z as v,q as U,v as x,A as V,y as c,m as Z,c as P,F as b,t as $,o as W,w as Y,x as G,f as T,B as H}from"./vue-DNanzPmn.js";import{b as J,u as K}from"./router-C-duPd4Y.js";import"./index-DxrLhrM7.js";import{u as B}from"./topics-DQFsMJ9m.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"message-form"},X={class:"username-input-container"},j={key:0,class:"no-username-warning"},ee={class:"form-footer"},se=["disabled"],te={__name:"MessageForm",props:{topicId:{type:String,required:!0}},emits:["message-added"],setup(w,{emit:g}){const k=w,f=g,r=h(""),p=h(""),_=B(),m=()=>{if(console.log("æäº¤ç•™è¨€:",{content:r.value,username:p.value}),!r.value.trim()){console.log("ç•™è¨€å†…å®¹ä¸ºç©º");return}const n=p.value.trim();if(!n){console.log("ç”¨æˆ·åä¸ºç©ºå­—ç¬¦ä¸²");return}const i={id:Date.now().toString(),content:r.value.trim(),username:n};_.addMessage(k.topicId,i),console.log("ç•™è¨€æ·»åŠ æˆåŠŸ:",i),r.value="",f("message-added")};return(n,i)=>(l(),o("div",Q,[i[3]||(i[3]=e("h3",{class:"form-title"},"å†™ä¸‹ä½ çš„ç•™è¨€ï¼š",-1)),e("div",X,[i[2]||(i[2]=e("label",{for:"username"},"æ‚¨çš„ç§°å‘¼ï¼š",-1)),U(e("input",{id:"username","onUpdate:modelValue":i[0]||(i[0]=u=>p.value=u),type:"text",placeholder:"è¯·è¾“å…¥æ‚¨çš„ç§°å‘¼",maxlength:"20",class:"username-input",autocomplete:"off"},null,512),[[x,p.value]])]),p.value.trim()?v("",!0):(l(),o("div",j," è¯·å…ˆè¾“å…¥æ‚¨çš„ç§°å‘¼æ‰èƒ½å‘è¡¨ç•™è¨€ ")),e("form",{onSubmit:Z(m,["prevent"])},[U(e("textarea",{"onUpdate:modelValue":i[1]||(i[1]=u=>r.value=u),placeholder:"è¯·è¾“å…¥ä½ çš„ç•™è¨€...",rows:"4",required:"",maxlength:"500"},null,512),[[x,r.value]]),e("div",ee,[e("span",{class:V(["char-count",{warning:r.value.length>450}])},c(r.value.length)+"/500 ",3),e("button",{type:"submit",class:"submit-btn",disabled:!r.value.trim()||!p.value.trim()}," å‘é€ç•™è¨€ ",8,se)])],32)]))}},oe=C(te,[["__scopeId","data-v-cf51d48d"]]),le={class:"message-list"},ae={key:0,class:"empty-state"},ne={key:1,class:"messages"},ie={class:"message-inner"},de={class:"message-header"},ce={class:"message-username"},re={class:"message-time"},ue={class:"message-content"},pe={class:"message-actions"},me=["onClick"],_e={__name:"MessageList",props:{messages:{type:Array,required:!0}},emits:["message-deleted"],setup(w,{emit:g}){const k=w,f=g,r=P(()=>[...k.messages].sort((m,n)=>new Date(n.timestamp)-new Date(m.timestamp))),p=m=>{const n=new Date(m),u=new Date-n;return u<60*1e3?"åˆšåˆš":u<3600*1e3?`${Math.floor(u/(60*1e3))}åˆ†é’Ÿå‰`:u<1440*60*1e3?`${Math.floor(u/(3600*1e3))}å°æ—¶å‰`:u<10080*60*1e3?`${Math.floor(u/(1440*60*1e3))}å¤©å‰`:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`},_=m=>{confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç•™è¨€å—ï¼Ÿ")&&f("message-deleted",m)};return(m,n)=>(l(),o("div",le,[n[1]||(n[1]=e("h3",{class:"list-title"},"ç•™è¨€ç¬”è®°æœ¬ï¼š",-1)),w.messages.length===0?(l(),o("div",ae,[...n[0]||(n[0]=[e("div",{class:"empty-icon"},"ğŸ’¬",-1),e("p",{class:"empty-text"},"æš‚æ— ç•™è¨€ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡ç•™è¨€å§ï¼",-1)])])):(l(),o("div",ne,[(l(!0),o(b,null,$(r.value,i=>(l(),o("div",{key:i.id,class:"message-item notebook-line"},[e("div",ie,[e("div",de,[e("span",ce,c(i.username),1),e("span",re,c(p(i.timestamp)),1)]),e("div",ue,c(i.content),1),e("div",pe,[e("button",{class:"delete-btn",onClick:u=>_(i.id),title:"åˆ é™¤ç•™è¨€"}," ğŸ—‘ï¸ ",8,me)])])]))),128))]))]))}},ve=C(_e,[["__scopeId","data-v-6c25111e"]]),he={class:"topic-detail-view"},ge={class:"container"},ke={class:"header"},fe={class:"topic-icon"},ye={class:"topic-title"},be={class:"message-count"},$e={class:"photo-wall"},we={class:"photo-grid"},Me=["onClick"],Ue={class:"photo-image"},xe=["src"],Ce={key:1,class:"photo-placeholder"},De={class:"photo-label"},Se={class:"zone-index"},Ie={class:"zone-title"},Te={class:"content"},Ve={class:"polaroid-section"},Ze={key:0,class:"polaroid-empty"},Pe={class:"polaroid-list"},Be={class:"polaroid-photo"},Fe={class:"polaroid-photo-inner"},Ae=["src"],Ne={key:1,class:"polaroid-upload-area"},qe=["onChange"],Le={class:"polaroid-upload-text"},Re={key:0,class:"polaroid-sticker"},ze={key:1},Ee={key:2,class:"polaroid-sticker-overlay"},Oe=["onUpdate:modelValue"],We={class:"polaroid-tools"},Ye={class:"polaroid-tools-row"},Ge={class:"sticker-picker"},He=["onClick"],Je=["onClick"],Ke={key:0,class:"share-section"},Qe=["onUpdate:modelValue"],Xe=["value"],je=["disabled","onClick"],es={class:"message-form-container notebook-form"},ss={class:"messages-container notebook-messages"},ts={class:"modal-header"},os={key:0,class:"modal-count"},ls={key:0,class:"modal-empty"},as={class:"modal-polaroids-list"},ns={class:"modal-polaroid-photo"},is=["src"],ds={key:1,class:"modal-sticker-overlay"},cs={key:0,class:"modal-polaroid-text"},rs={__name:"TopicDetailView",setup(w){const g=K(),k=J(),f=B(),r=h(""),p=h({id:"",name:"åŠ è½½ä¸­...",icon:"â³",color:"#95a5a6"}),_=h([{title:"æ—¥å¸¸ç¢ç‰‡",image:null,uploadedImage:null,polaroids:[]},{title:"å°å°å¿ƒæ„¿",image:null,uploadedImage:null,polaroids:[]},{title:"è¯¾å ‚è®°å¿†",image:null,uploadedImage:null,polaroids:[]},{title:"æ²»æ„ˆç¬é—´",image:null,uploadedImage:null,polaroids:[]}]),m=h(!1),n=h([]),i=h("");let u=0;const M=h([]),F=h(["ğŸ˜€","ğŸ¥°","â­","ğŸŒ¸","ğŸˆ","ğŸŒ™"]),D=P(()=>f.getTopicMessages(r.value)),S=()=>{const d=k.params.id;if(!d){g.push("/topics");return}r.value=d;const t=f.getTopicById(d);t?p.value=t:g.push("/topics")},A=()=>{console.log("ç•™è¨€å·²æ·»åŠ ")},N=()=>{u+=1,M.value.unshift({id:u,text:"",sticker:"",photo:null,photoUrl:null,selectedZone:""})},q=d=>{M.value=M.value.filter(t=>t.id!==d)},L=(d,t)=>{const s=d.target.files[0];if(s&&s.type.startsWith("image/")){const a=new FileReader;a.onload=y=>{t.photo=s,t.photoUrl=y.target.result},a.readAsDataURL(s)}},R=(d,t)=>{if(d.photoUrl&&t!==null&&t!==void 0&&t!==""){const s=parseInt(t);if(!isNaN(s)&&s>=0&&s<_.value.length){const a={photoUrl:d.photoUrl,text:d.text,sticker:d.sticker,timestamp:new Date().toISOString()};_.value[s].polaroids.push(a),_.value[s].uploadedImage=d.photoUrl,alert(`ç…§ç‰‡å·²åˆ†äº«åˆ°ã€Œ${_.value[s].title}ã€`),d.selectedZone=""}}},z=d=>{const t=_.value[d];t.polaroids&&t.polaroids.length>0&&(n.value=t.polaroids,i.value=t.title,m.value=!0)},I=()=>{m.value=!1,n.value=[],i.value=""},E=d=>{f.deleteMessage(r.value,d)},O=()=>{g.push("/topics")};return W(()=>{S()}),k.params.id&&Y(()=>k.params.id,d=>{d&&S()}),(d,t)=>(l(),o("div",he,[e("div",ge,[e("div",ke,[e("button",{class:"back-btn",onClick:O},"â† è¿”å›è¯é¢˜åˆ—è¡¨"),e("div",{class:"topic-info",style:G({"--accent-color":p.value.color})},[e("div",fe,c(p.value.icon),1),e("h1",ye,c(p.value.name),1),e("p",be,c(D.value.length)+" æ¡ç•™è¨€",1)],4)]),e("section",$e,[t[3]||(t[3]=e("div",{class:"rope"},null,-1)),e("div",we,[(l(!0),o(b,null,$(_.value,(s,a)=>(l(),o("div",{key:a,class:V(["photo-card",{"has-polaroid":s.polaroids&&s.polaroids.length>0}]),onClick:y=>z(a)},[t[2]||(t[2]=e("div",{class:"clip"},null,-1)),e("div",Ue,[s.uploadedImage?(l(),o("img",{key:0,src:s.uploadedImage,alt:"ä¸Šä¼ çš„ç…§ç‰‡",class:"photo-uploaded-img"},null,8,xe)):(l(),o("div",Ce,[...t[1]||(t[1]=[e("span",{class:"placeholder-text"},"å¾…ä¸Šä¼ ",-1)])]))]),e("div",De,[e("span",Se,"#"+c(a+1),1),e("span",Ie,c(s.title),1)])],10,Me))),128))])]),e("div",Te,[e("section",Ve,[t[7]||(t[7]=e("div",{class:"polaroid-header"},[e("h2",null,"æ‹ç«‹å¾—äº’åŠ¨åŒº"),e("p",null,"ç‚¹å‡»ã€Œæ‹ä¸€å¼ ã€ï¼Œç”Ÿæˆä½ çš„ä¸“å±æ‹ç«‹å¾—å°å¡ç‰‡ï¼Œå¯ä»¥è´´è¡¨æƒ…è´´çº¸ã€å†™ä¸‹æƒ³è¯´çš„è¯ã€‚")],-1)),e("button",{class:"polaroid-btn",onClick:N},"ğŸ“¸ æ‹ä¸€å¼ "),M.value.length===0?(l(),o("div",Ze," è¿˜æ²¡æœ‰æ‹ç«‹å¾—å“¦ï¼Œç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®æ‹ä¸€å¼ å§ï½ ")):v("",!0),e("div",Pe,[(l(!0),o(b,null,$(M.value,s=>(l(),o("div",{key:s.id,class:"polaroid-card"},[e("div",Be,[e("div",Fe,[s.photoUrl?(l(),o("img",{key:0,src:s.photoUrl,alt:"ä¸Šä¼ çš„ç…§ç‰‡",class:"polaroid-uploaded-image"},null,8,Ae)):(l(),o("div",Ne,[e("input",{type:"file",accept:"image/*",class:"polaroid-file-input",onChange:a=>L(a,s)},null,40,qe),e("span",Le,[s.sticker?(l(),o("span",Re,c(s.sticker),1)):(l(),o("span",ze,"ğŸ“· ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡"))])])),s.sticker&&s.photoUrl?(l(),o("span",Ee,c(s.sticker),1)):v("",!0)])]),U(e("textarea",{"onUpdate:modelValue":a=>s.text=a,class:"polaroid-text",rows:"2",placeholder:"åœ¨è¿™é‡Œå†™ä¸‹ä¸€å¥æƒ³è¯´çš„è¯..."},null,8,Oe),[[x,s.text]]),e("div",We,[e("div",Ye,[e("div",Ge,[t[4]||(t[4]=e("span",{class:"sticker-label"},"è´´çº¸ï¼š",-1)),(l(!0),o(b,null,$(F.value,a=>(l(),o("button",{key:a,type:"button",class:"sticker-btn",onClick:y=>s.sticker=a},c(a),9,He))),128))]),e("button",{type:"button",class:"polaroid-remove",onClick:a=>q(s.id)}," åˆ é™¤ ",8,Je)]),s.photoUrl?(l(),o("div",Ke,[t[6]||(t[6]=e("span",{class:"share-label"},"åˆ†äº«åˆ°ï¼š",-1)),U(e("select",{"onUpdate:modelValue":a=>s.selectedZone=a,class:"zone-select"},[t[5]||(t[5]=e("option",{value:""},"é€‰æ‹©åˆ†åŒº",-1)),(l(!0),o(b,null,$(_.value,(a,y)=>(l(),o("option",{key:y,value:y},c(a.title),9,Xe))),128))],8,Qe),[[H,s.selectedZone]]),e("button",{type:"button",class:"share-btn",disabled:s.selectedZone===""||s.selectedZone===null,onClick:a=>R(s,s.selectedZone)}," åˆ†äº« ",8,je)])):v("",!0)])]))),128))])]),e("div",es,[T(oe,{"topic-id":r.value,onMessageAdded:A},null,8,["topic-id"])]),e("div",ss,[T(ve,{messages:D.value,onMessageDeleted:E},null,8,["messages"])])])]),m.value?(l(),o("div",{key:0,class:"polaroid-modal-overlay",onClick:I},[e("div",{class:"polaroid-modal-content",onClick:t[0]||(t[0]=Z(()=>{},["stop"]))},[e("button",{class:"modal-close-btn",onClick:I},"Ã—"),e("div",ts,[e("h3",null,c(i.value),1),n.value.length>0?(l(),o("p",os," å…± "+c(n.value.length)+" å¼ æ‹ç«‹å¾— ",1)):v("",!0)]),n.value.length===0?(l(),o("div",ls," è¯¥åˆ†åŒºè¿˜æ²¡æœ‰æ‹ç«‹å¾— ")):v("",!0),e("div",as,[(l(!0),o(b,null,$(n.value,(s,a)=>(l(),o("div",{key:a,class:"modal-polaroid-card"},[e("div",ns,[s.photoUrl?(l(),o("img",{key:0,src:s.photoUrl,alt:"æ‹ç«‹å¾—ç…§ç‰‡",class:"modal-photo-img"},null,8,is)):v("",!0),s.sticker?(l(),o("span",ds,c(s.sticker),1)):v("",!0)]),s.text?(l(),o("div",cs,c(s.text),1)):v("",!0)]))),128))])])])):v("",!0)]))}},hs=C(rs,[["__scopeId","data-v-d49518e1"]]);export{hs as default};
